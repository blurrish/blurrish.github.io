<!DOCTYPE html>

<html>

<head>

</head>

<body>
    <div id="content">

    </div>
    <input id="open-btn" type="button" onclick="openProtocol()" value="Launch Jyro"></input>
    <input type='button' value='Test Custom Url' onclick='goto6()'>


    <!-- <input type="button" onclick="openProtocol('jyro')" value="jyro://"></input> -->
    <!-- <input type="button" onclick="openProtocol('mycoolapp')" value="mycoolapp://"></input> -->
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        var id = urlParams.get('id');
        var name = urlParams.get('name');

        document.querySelector("#content").innerHTML =
            "\
            Welcome to Jyro. \
            You have been invited by "+ name + "\
            Click the link below to open the Jyro app and play with "+ name + "\
        ";

        function goto(url, fallback) {
            var script = document.createElement('script');

            script.onload = function (resp) {
                debugger
                document.location = url;
            }
            script.onerror = function (err) {
                console.error(err)
  
                // document.location = fallback;
            }
            script.setAttribute('src', url);

            document.getElementsByTagName('head')[0].appendChild(script);
        }

        function goto2(url, fallback) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open('GET', url, false);
            try {
                xmlhttp.send(null);                  // Send the request now
            } catch (e) {
                //document.location = fallback;
                console.error(e)
                return;
            }

            // Throw an error if the request was not 200 OK 
            if (xmlhttp.status === 200) {
                document.location = url;
            } else {
                debugger
                // document.location = fallback;
            }
        }

        function launchCustomProtocol(elem, url, callback) {
    var iframe, myWindow, success = false;



        elem.css({"outline": 0});
        elem.attr("tabindex", "1");
        elem.focus();

        elem.blur(function () {
            success = true;
            callback(true);  // true
        });

        location.href = url;

        setTimeout(function () {
            elem.off('blur');
            elem.removeAttr("tabindex");

            if (!success) {
                callback(false);  // false
            }
        }, 1000);
   
}



function submitRequest(buttonId) {
            if (document.getElementById(buttonId) == null || document.getElementById(buttonId) == undefined) return;
            if (document.getElementById(buttonId).dispatchEvent) {
                    var e = document.createEvent("MouseEvents");
                    e.initEvent("click", true, true);
                    document.getElementById(buttonId).dispatchEvent(e);
            } 
            else {
                    document.getElementById(buttonId).click();
            }
        }
    
        function goto6(url){
            var f = document.getElementById('customUrlLink')
            if (f ) {f.parentNode.removeChild(f);}
            var a = document.createElement('a');
            a.href =  "jyroapp://";    
            a.innerHTML = "Link"                                    
            a.setAttribute('id',        'customUrlLink');
            a.setAttribute("style", "display:none; "); 
            document.body.appendChild(a); 
            submitRequest("customUrlLink");
        }


        function goto3(url) {
            fetch(url).then(console.log).catch(console.error)
        }

        function goto4(url) {
            var elem = document.querySelector("#content")
            launchCustomProtocol(elem, url, console.log)
        }
        function goto5(url) {
            window.location.assign(url);
        }

        function openProtocol(protocol) {
            // window.open('jyroapp://?id='+id, '_system')
            window.open('jyroapp://?id='+id, '_self')
            setTimeout(function(){
    if(confirm('Missing. Download it now?')){
      document.location = 'https://google.com';
    }
  }, 25);
            //window.open('/invite?id=' + id, '_self')
        }

        document.addEventListener("DOMContentLoaded", function () {
            //document.querySelector("#open-btn").click()
            //goto6('jyroapp://', 'https://www.google.com')
            window.open('https://blurrish.com/invite?id=123', '_self')
        })
    </script>


</body>

</html>